<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Главная страница с фиксированными панелями</title>
    <!-- Подключение Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Подключение Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        /* Установка шрифта Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            /* Устанавливаем цвет фона страницы: #0F0F0F */
            background-color: #0F0F0F;
            min-height: 100vh;
            margin: 0;
            /* Отступ, чтобы контент не перекрывался нижним меню */
            padding-bottom: 100px; 
            overflow-x: hidden; /* Предотвращаем горизонтальный скролл */
            
            /* --- СТИЛИ ДЛЯ ЗАПРЕТА КОПИРОВАНИЯ --- */
            -webkit-user-select: none; 
            -ms-user-select: none; 
            user-select: none; 
        }
        
        /* Стили для Верхней Шапки */
        .header-style {
            /* Скругление углов только снизу: 24px */
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
            /* Обводка снизу цвета #0000FF */
            border-bottom: 4px solid #0000FF;
            /* Темный фон для шапки */
            background-color: #1a1a1a; 
        }

        /* --- Стили для Нижнего Навигационного Меню (M3) --- */
        .nav-item.active .icon-container {
            background-color: #0000FF;
            color: #FFFFFF; 
        }
        .nav-item.active svg {
             color: #FFFFFF;
        }
        .nav-item svg {
            color: #C4C7C5; 
            transition: color 0.2s;
        }
        .nav-bar {
            background-color: #1F1F1F;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
        }

        /* --- Стили для Календаря --- */
        .calendar-item.selected-border {
            border: 1px solid #0000FF;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* --- Стили для пустого состояния контента --- */
        .empty-state-icon {
            color: #0000FF; 
            width: 80px; 
            height: 80px;
        }

        /* --- Стили для кнопки "Завершить смену" --- */
        .close-shift-button {
            height: 50px; 
            width: 50px; 
            background-color: #1a1a1a; 
            border: 1px solid #0000FF; 
            border-radius: 6px; 
            flex-shrink: 0;
            position: relative; 
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .close-shift-button::before {
            content: ''; 
            position: absolute; 
            top: 8px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 2px; 
            height: 15px; 
            background-color: #0000FF;
            border-radius: 2px; 
        }
        .close-shift-button::after {
            content: ''; 
            position: absolute; 
            width: 30px; 
            height: 30px; 
            border: 2px solid #0000FF; 
            border-top-color: transparent; 
            border-radius: 50%; 
            bottom: 8px;
        }

        /* --- СТИЛИ ДЛЯ BOTTOM SHEET --- */
        
        .bottom-sheet-overlay {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .bottom-sheet-content {
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .bottom-sheet-overlay.open {
            visibility: visible;
            opacity: 1;
        }
        
        .bottom-sheet-overlay.open .bottom-sheet-content {
            transform: translateY(0);
        }

        /* --- СТИЛИ ДЛЯ УВЕДОМЛЕНИЙ (Notification Area) --- */
        #notification-area {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 100vw;
            z-index: 50;
            /* Убедитесь, что уведомления не мешают кликам, пока не активны */
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- СТИЛИ ДЛЯ СПИННЕРА ЗАГРУЗКИ --- */
        .spinner {
            width: 60px; 
            height: 60px;
            animation: rotate 2s linear infinite; 
            transform-origin: center center;
        }

        .path {
            stroke: #0000FF; 
            stroke-linecap: round;
            stroke-width: 4; 
            stroke-dasharray: 1, 150; 
            animation: dash 1.5s ease-in-out infinite; 
        }

        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }

        @keyframes dash {
            0% {
                stroke-dasharray: 1, 150;
                stroke-dashoffset: 0;
            }
            50% {
                stroke-dasharray: 70, 150; 
                stroke-dashoffset: -25px;
            }
            100% {
                stroke-dasharray: 70, 150;
                stroke-dashoffset: -125px;
            }
        }
        
        /* СТИЛИ ДЛЯ ОВЕРЛЕЯ ЗАГРУЗКИ */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(15, 15, 15, 0.8); 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100; 
            
            transition: opacity 0.3s ease, visibility 0.3s ease;
            opacity: 0; 
            visibility: hidden;
            pointer-events: none; 
        }

        #loadingOverlay.visible {
            opacity: 1;
            visibility: visible;
            pointer-events: auto; 
        }
    </style>
</head>
<body class="text-white">

    <!-- Полупрозрачный оверлей загрузки (изначально скрыт) -->
    <div id="loadingOverlay">
        
        <!-- SVG-спиннер -->
        <svg id="loader" class="spinner" viewBox="25 25 50 50">
            <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10" />
        </svg>
    </div>

    <!-- Контейнер для уведомлений (всегда вверху и по центру) -->
    <div id="notification-area">
        <!-- Уведомления будут добавляться сюда JS -->
    </div>

    <!-- Верхняя Шапка (Header) - Закреплена сверху -->
    <header class="w-full header-style sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            
            <!-- TOP ROW (Title + Profile Button) -->
            <div class="flex justify-between items-center h-8 mb-4">
                
                <!-- Левый элемент: "Главный экран" -->
                <h1 class="text-lg font-bold text-white">
                    Главный экран
                </h1>

                <!-- Правый элемент: Кнопка профиля -->
                <button id="profile-button" class="flex items-center justify-center p-1 rounded-full border border-solid hover:bg-white/10 transition-colors" style="border-color: #0000FF;">
                    <i data-lucide="circle-user" class="w-6 h-6" style="color: #0000FF;"></i>
                </button>
            </div>

            <!-- CALENDAR STRIP (Горизонтально прокручиваемый календарь) -->
            <div id="calendar-strip" class="flex overflow-x-scroll space-x-3 pb-2 -mx-4 px-4 scrollbar-hide">
                <!-- Даты будут сгенерированы JavaScript -->
            </div>

            <!-- БЛОК ДЕЙСТВИЙ (динамическое переключение) -->
            <div id="shift-action-container" class="w-full mt-4 items-center">
                
                <!-- 1. Кнопка "Завершить смену" (Иконка) - Скрыта по умолчанию -->
                <div id="end-shift-button" class="close-shift-button" style="display: none;">
                    <!-- Иконка полностью создается с помощью CSS ::before и ::after -->
                </div>

                <!-- 2. Главная кнопка действия (Начать смену / Перейти к задачам) -->
                <button 
                    id="main-action-button"
                    class="text-center text-white font-bold transition-opacity duration-200 shadow-lg"
                    style="padding: 14px; border-radius: 6px; background-color: #0000FF; height: 50px;"
                >
                    Начать смену
                </button>
            </div>

        </div>
    </header>

    <!-- Основное содержимое страницы - Скроллируемая область -->
    <main class="flex flex-col items-center justify-center min-h-[50vh] pt-16 pb-16 text-center">
        <!-- Значок расписания и текст "Ближайших смен нет" -->
        <i data-lucide="calendar-days" class="empty-state-icon" aria-hidden="true"></i>
        <p class="text-xl text-gray-400 mt-4">
            Ближайших смен нет
        </p>
    </main>

    <!-- Плавающее Нижнее Навигационное Меню - Закреплено внизу -->
    <nav class="nav-bar fixed bottom-6 left-1/2 transform -translate-x-1/2 max-w-md w-[calc(100%-3rem)] rounded-full p-2 z-50 transition-all duration-300">
        <div class="flex justify-between items-center h-14">

            <!-- 1. Главный (Home) -->
            <button class="nav-item active flex flex-col items-center justify-center h-full" data-name="Главный">
                <div class="icon-container w-12 h-8 flex items-center justify-center rounded-full transition-colors duration-200">
                    <i data-lucide="home" class="w-6 h-6"></i>
                </div>
            </button>

            <!-- 2. Расписание (Calendar) -->
            <button class="nav-item flex flex-col items-center justify-center h-full" data-name="Расписание">
                <div class="icon-container w-12 h-8 flex items-center justify-center rounded-full transition-colors duration-200">
                    <i data-lucide="calendar-days" class="w-6 h-6"></i>
                </div>
            </button>
            
            <!-- 3. Местоположение (Location) -->
            <button class="nav-item flex flex-col items-center justify-center h-full" data-name="Местоположение">
                <div class="icon-container w-12 h-8 flex items-center justify-center rounded-full transition-colors duration-200">
                    <i data-lucide="map-pin" class="w-6 h-6"></i>
                </div>
            </button>

            <!-- 4. Выплаты (Payments) -->
            <button class="nav-item flex flex-col items-center justify-center h-full" data-name="Выплаты">
                <div class="icon-container w-12 h-8 flex items-center justify-center rounded-full transition-colors duration-200">
                    <i data-lucide="credit-card" class="w-6 h-6"></i>
                </div>
            </button>

            <!-- 5. Обучение (Learning) -->
            <button class="nav-item flex flex-col items-center justify-center h-full" data-name="Обучение">
                <div class="icon-container w-12 h-8 flex items-center justify-center rounded-full transition-colors duration-200">
                    <i data-lucide="graduation-cap" class="w-6 h-6"></i>
                </div>
            </button>

            <!-- 6. Чаты (Chats) -->
            <button class="nav-item flex flex-col items-center justify-center h-full" data-name="Чаты">
                <div class="icon-container w-12 h-8 flex items-center justify-center rounded-full transition-colors duration-200">
                    <i data-lucide="message-square-more" class="w-6 h-6"></i>
                </div>
            </button>
        </div>
    </nav>
    
    <!-- BOTTOM SHEET (Модальное окно для завершения смены) -->
    <div id="bottom-sheet" class="bottom-sheet-overlay fixed inset-0 bg-black/60 z-50 flex justify-center items-end">
        <div 
            class="bottom-sheet-content w-full max-w-md bg-[#1F1F1F] text-white p-6 rounded-t-2xl shadow-xl"
            onclick="event.stopPropagation()"
        >
            <div class="text-center mb-4">
                <h2 class="text-2xl font-bold mb-2">Завершить смену?</h2>
                <p class="text-gray-400 text-sm">Раннее завершение смены, может повлиять на твой рейтинг</p>
            </div>
            
            <div class="flex flex-col space-y-3">
                
                <!-- Кнопка "Завершить" -->
                <button id="confirm-end-shift-btn" 
                    class="w-full text-center text-white font-bold py-4 rounded-md transition-colors duration-200"
                    style="background-color: #0000FF; border-radius: 6px;"
                >
                    Завершить
                </button>
                
                <!-- Кнопка "Не завершать" -->
                <button id="cancel-end-shift-btn" 
                    class="w-full text-center font-bold py-4 rounded-md transition-colors duration-200"
                    style="border: 1px solid #0000FF; color: #0000FF; background-color: transparent; border-radius: 6px;"
                >
                    Не завершать
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript для логики календаря, меню, кнопок смены, уведомлений и свайпа -->
    <script>
        // Инициализация Lucide Icons
        lucide.createIcons();

        // --- ГЛОБАЛЬНЫЕ ЭЛЕМЕНТЫ ДЛЯ ЗАГРУЗКИ ---
        const loadingOverlay = document.getElementById('loadingOverlay');
        const SIMULATED_LOAD_TIME = 1500; // 1.5 секунды симуляции загрузки

        /**
         * Показывает оверлей загрузки.
         */
        function showLoading() {
            loadingOverlay.classList.add('visible');
        }

        /**
         * Скрывает оверлей загрузки.
         */
        function hideLoading() {
            loadingOverlay.classList.remove('visible');
        }

        /**
         * Оборачивает функцию действия с добавлением анимации загрузки.
         * @param {function} callback - Исходная функция, которую нужно выполнить.
         * @returns {function} Обернутая функция.
         */
        function wrapWithLoading(callback) {
            return function(event) {
                // Если клик произошел на оверлее Bottom Sheet, не запускаем загрузку
                if (event.currentTarget.id === 'bottom-sheet') {
                    callback(event);
                    return;
                }
                
                showLoading();

                setTimeout(() => {
                    // Выполняем исходную логику
                    callback(event);
                    
                    // Скрываем оверлей после завершения имитации
                    hideLoading();
                }, SIMULATED_LOAD_TIME); 
            };
        }
        // ----------------------------------------------------
        
        // --- НОВАЯ ФУНКЦИЯ: ПЕРЕНАПРАВЛЕНИЕ ---
        const ACCESS_ERROR_URL = 'https://u8902054545-design.github.io/access-error/';
        
        /**
         * Перенаправляет пользователя на страницу ошибки доступа.
         */
        function redirectToAccessError() {
            window.location.href = ACCESS_ERROR_URL;
        }
        // ------------------------------------


        // --- УТИЛИТАРНЫЕ ФУНКЦИИ ---

        /**
         * Форматирует время в формате ЧЧ:ММ.
         */
        function formatTime(date) {
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }
        
        // --- ФУНКЦИИ ДЛЯ ЗАПРЕТА КОПИРОВАНИЯ ---
        function disableTextCopy() {
            document.addEventListener('selectstart', (e) => { e.preventDefault(); });
            document.addEventListener('copy', (e) => { e.preventDefault(); });
            document.addEventListener('contextmenu', (e) => { e.preventDefault(); });
        }
        disableTextCopy();
        // -------------------------------------------

        /**
         * Добавляет логику свайпа вверх для закрытия уведомления.
         * @param {HTMLElement} element - Элемент уведомления.
         */
        function addSwipeDismissal(element) {
            let startY = 0;
            let currentY = 0;
            let isDragging = false;
            const SWIPE_THRESHOLD = 50; // Расстояние свайпа в пикселях для закрытия

            element.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    startY = e.touches[0].clientY;
                    // Временно отключаем CSS transition для плавного перетаскивания
                    element.style.transition = 'none';
                    isDragging = true;
                }
            }, { passive: true }); 

            element.addEventListener('touchmove', (e) => {
                if (!isDragging || e.touches.length !== 1) return;

                currentY = e.touches[0].clientY;
                const diffY = startY - currentY; // Положительное число = свайп вверх

                if (diffY > 0) {
                    // Применяем смещение только при свайпе вверх
                    element.style.transform = `translateY(-${diffY}px)`;
                } else {
                    // Блокируем свайп вниз
                    element.style.transform = `translateY(0px)`;
                }
            }, { passive: true });

            element.addEventListener('touchend', (e) => {
                if (!isDragging) return;
                
                isDragging = false;
                const diffY = startY - currentY;
                
                // Снова включаем CSS transition для плавного сброса или закрытия
                element.style.transition = 'all 0.3s ease-out';

                if (diffY > SWIPE_THRESHOLD) {
                    // Закрываем, если свайп достаточно большой
                    dismissNotification(element);
                } else {
                    // Сбрасываем позицию, если свайп был недостаточен
                    element.style.transform = 'translateY(0)';
                }
            });
            
            // Обработка отмены
            element.addEventListener('touchcancel', () => {
                isDragging = false;
                element.style.transition = 'all 0.3s ease-out';
                element.style.transform = 'translateY(0)';
            });
        }


        // --- ЛОГИКА УВЕДОМЛЕНИЙ ---

        /**
         * Функция для создания и отображения уведомления в верхней части экрана.
         */
        function createNotification(type, message) {
            const isSuccess = type === 'success';

            // Определяем цвета
            const successBg = 'bg-[#1a1a1a]/90 ring-1 ring-[#0000FF]'; 
            const successIcon = 'text-[#0000FF]'; 
            const errorBg = 'bg-red-900/90 ring-1 ring-white/20';
            const errorIcon = 'text-red-300';
            
            const bgColor = isSuccess ? successBg : errorBg;
            const iconColor = isSuccess ? successIcon : errorIcon;

            const icon = isSuccess 
                ? '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'
                : '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.391 16c-.77 1.333.192 3 1.732 3z"></path></svg>';

            const notificationArea = document.getElementById('notification-area');
            const notification = document.createElement('div');
            
            notification.className = `
                max-w-xs sm:max-w-md w-full mx-4 mt-4 p-4
                ${bgColor} text-white
                rounded-xl shadow-2xl backdrop-blur-sm
                transform transition-all duration-500 ease-out
                opacity-0 -translate-y-20
                flex items-center justify-between pointer-events-auto
            `;
            notification.innerHTML = `
                <div class="flex items-center flex-grow">
                    <div class="${iconColor} mr-3 flex-shrink-0">
                        ${icon}
                    </div>
                    <div>
                        <p class="font-bold text-sm sm:text-base text-white">${isSuccess ? 'Событие' : 'Ошибка'}</p>
                        <p class="text-xs sm:text-sm opacity-90">${message}</p>
                    </div>
                </div>
                <button class="ml-4 p-1 rounded-full hover:bg-black/20 transition flex-shrink-0" onclick="dismissNotification(this.closest('.max-w-xs, .sm:max-w-md, .w-full'))">
                    <!-- Иконка закрытия -->
                    <svg class="w-4 h-4 text-white opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            `;

            notificationArea.appendChild(notification);
            
            // --- ДОБАВЛЕНИЕ ЛОГИКИ СВАЙПА ---
            addSwipeDismissal(notification); 
            // ---------------------------------


            // 1. Показать:
            setTimeout(() => {
                notification.classList.remove('opacity-0', '-translate-y-20');
                notification.classList.add('opacity-100', 'translate-y-0');
            }, 10);

            // 2. Авто-закрытие:
            setTimeout(() => {
                dismissNotification(notification);
            }, 4000);
        }

        /**
         * Функция для скрытия и удаления уведомления.
         */
        function dismissNotification(notificationElement) {
            if (!notificationElement || notificationElement.classList.contains('opacity-0')) return;

            // Скрываем, используя существующие классы анимации
            notificationElement.classList.remove('opacity-100', 'translate-y-0');
            notificationElement.classList.add('opacity-0', '-translate-y-20');
            
            // Сброс трансформации, если она была применена свайпом
            notificationElement.style.transform = ''; 

            // Удаляем из DOM после завершения анимации (500мс)
            setTimeout(() => {
                notificationElement.remove();
            }, 500);
        }


        // --- Логика Bottom Sheet ---
        const bottomSheet = document.getElementById('bottom-sheet');
        const confirmEndShiftBtn = document.getElementById('confirm-end-shift-btn');
        const cancelEndShiftBtn = document.getElementById('cancel-end-shift-btn'); 

        function openBottomSheet() {
            bottomSheet.classList.add('open');
            document.body.style.overflow = 'hidden'; 
        }

        function closeBottomSheet() {
            bottomSheet.classList.remove('open');
            document.body.style.overflow = ''; 
        }

        bottomSheet.addEventListener('click', wrapWithLoading(closeBottomSheet));
        cancelEndShiftBtn.addEventListener('click', wrapWithLoading(closeBottomSheet));


        // --- Логика Кнопок Смены ---
        const mainActionButton = document.getElementById('main-action-button');
        const endShiftButton = document.getElementById('end-shift-button');
        const profileButton = document.getElementById('profile-button'); 
        const shiftActionContainer = document.getElementById('shift-action-container'); 
        let isShiftActive = false;
        
        // Эта функция оставлена для имитации, но обработчики кликов теперь перенаправляют
        function updateShiftState(active) {
            isShiftActive = active;
            const currentTime = formatTime(new Date());

            if (isShiftActive) {
                shiftActionContainer.classList.add('flex', 'space-x-3');
                shiftActionContainer.classList.remove('w-full'); 

                mainActionButton.textContent = 'Перейти к задачам';
                mainActionButton.classList.add('flex-grow');
                mainActionButton.classList.remove('w-full'); 
                endShiftButton.style.display = 'flex'; 
                
                // createNotification('success', `Смена открыта в ${currentTime}`);
            } else {
                shiftActionContainer.classList.remove('flex', 'space-x-3');
                
                mainActionButton.textContent = 'Начать смену';
                endShiftButton.style.display = 'none'; 
                mainActionButton.classList.add('w-full'); 
                mainActionButton.classList.remove('flex-grow'); 

                // createNotification('success', `Смена закрыта в ${currentTime}`);
            }
        }

        updateShiftState(false);


        // --- Обработчики, обернутые в анимацию загрузки и ПЕРЕНАПРАВЛЕНИЯ ---

        // 1. Обработчик для ГЛАВНОЙ кнопки (Начать смену / Перейти к задачам)
        mainActionButton.addEventListener('click', wrapWithLoading(() => {
            // Перенаправляем на страницу ошибки доступа после симуляции загрузки
            redirectToAccessError();
        }));

        // 2. Обработчик для кнопки "Завершить смену" (Иконка)
        endShiftButton.addEventListener('click', wrapWithLoading(() => {
            // Перенаправляем на страницу ошибки доступа вместо открытия Bottom Sheet
            redirectToAccessError();
        }));
        
        // 3. Обработчик для кнопки "Завершить" в Bottom Sheet
        confirmEndShiftBtn.addEventListener('click', wrapWithLoading(() => {
            // Перенаправляем на страницу ошибки доступа вместо завершения смены
            redirectToAccessError();
        }));
        
        // 4. Обработчик для кнопки "Профиль"
        profileButton.addEventListener('click', wrapWithLoading(() => {
            // Перенаправляем на страницу ошибки доступа
            redirectToAccessError();
        }));


        // --- Логика Календаря и Меню ---

        const calendarContainer = document.getElementById('calendar-strip');
        const today = new Date();
        let selectedDateElement = null;

        const getDayName = (date) => {
            const days = ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'];
            return days[date.getDay()];
        };

        for (let i = 0; i < 30; i++) {
            const date = new Date(today);
            date.setDate(today.getDate() + i);

            const isToday = i === 0;
            const dayName = getDayName(date);
            const dateNumber = date.getDate();

            const dateItem = document.createElement('div');
            dateItem.className = 'calendar-item flex flex-col items-center justify-center p-2 rounded-xl cursor-pointer transition-all duration-150 flex-shrink-0 w-16';
            dateItem.setAttribute('data-date', date.toISOString().split('T')[0]);

            dateItem.innerHTML = `
                <span class="text-sm font-semibold">${dayName}</span>
                <span class="text-xl font-extrabold mt-1">${dateNumber}</span>
            `;
            
            if (isToday) {
                 dateItem.style.color = '#0000FF'; 
                 dateItem.classList.add('selected-border');
                 selectedDateElement = dateItem;
            }

            calendarContainer.appendChild(dateItem);
        }

        // 5. Обработчик для Календаря, обернутый в анимацию загрузки
        calendarContainer.addEventListener('click', wrapWithLoading((event) => {
            let target = event.target.closest('.calendar-item');
            if (!target) return;

            // Перенаправляем на страницу ошибки доступа после выбора даты
            redirectToAccessError();
            
            // Оригинальная логика выбора даты удалена, но оставим для справки, если нужно будет ее вернуть
            /* if (selectedDateElement) {
                selectedDateElement.classList.remove('selected-border');
            }

            selectedDateElement = target;
            selectedDateElement.classList.add('selected-border'); 
            */
        }));


        window.onload = () => {
            lucide.createIcons();
            
            if (selectedDateElement) {
                const scrollPosition = selectedDateElement.offsetLeft - calendarContainer.offsetWidth / 2 + selectedDateElement.offsetWidth / 2;
                calendarContainer.scrollTo({
                    left: scrollPosition,
                    behavior: 'smooth'
                });
            }
        };

        const navItems = document.querySelectorAll('.nav-item');

        // 6. Обработчик для Навигационных кнопок, обернутый в анимацию загрузки
        navItems.forEach(item => {
            item.addEventListener('click', wrapWithLoading(() => {
                // Перенаправляем на страницу ошибки доступа после клика
                redirectToAccessError();
                
                // Оригинальная логика активации меню удалена, но оставим для справки
                /*
                navItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                */
            }));
        });
    </script>
</body>
</html>
